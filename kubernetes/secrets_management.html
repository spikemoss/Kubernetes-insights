<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secrets Management | Kubernetes Security Guide</title>
    <meta name="description" content="Guide to managing secrets in Kubernetes - encryption, external secret stores, Vault integration, and secure credential handling">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --primary: #1e40af; --primary-light: #3b82f6; --accent: #06b6d4; --success: #10b981; --warning: #f59e0b; --danger: #ef4444; --bg-light: #f8fafc; --bg-card: #ffffff; --text-dark: #0f172a; --text-gray: #64748b; --border: #e2e8f0; --shadow: 0 4px 6px -1px rgba(0,0,0,0.1); --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1); }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #dbeafe 100%); color: var(--text-dark); line-height: 1.6; min-height: 100vh; display: flex; flex-direction: column; }
        header { background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; padding: 3rem 2rem; text-align: center; box-shadow: var(--shadow-lg); position: relative; overflow: hidden; }
        header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="rgba(255,255,255,0.1)" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,138.7C960,139,1056,117,1152,96C1248,75,1344,53,1392,42.7L1440,32L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') no-repeat bottom; background-size: cover; opacity: 0.3; }
        .back-link { display: inline-flex; align-items: center; gap: 0.5rem; color: white; text-decoration: none; margin-bottom: 1.5rem; padding: 0.5rem 1rem; background: rgba(255,255,255,0.2); border-radius: 8px; transition: all 0.3s; position: relative; z-index: 1; }
        .back-link:hover { background: rgba(255,255,255,0.3); }
        header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; position: relative; z-index: 1; }
        header p { font-size: 1.125rem; opacity: 0.95; position: relative; z-index: 1; }
        main { flex: 1; max-width: 1000px; width: 100%; margin: 0 auto; padding: 3rem 2rem; }
        .intro-section { background: var(--bg-card); padding: 2rem; border-radius: 12px; box-shadow: var(--shadow); margin-bottom: 2rem; }
        .intro-section h2 { font-size: 1.875rem; color: var(--primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem; }
        .intro-section h3 { font-size: 1.375rem; color: var(--primary); margin-top: 1.5rem; margin-bottom: 0.75rem; }
        .intro-section p { color: var(--text-gray); font-size: 1rem; line-height: 1.75; margin-bottom: 1rem; }
        .intro-section ul, .intro-section ol { color: var(--text-gray); margin-left: 2rem; margin-bottom: 1rem; }
        .intro-section li { margin-bottom: 0.5rem; line-height: 1.75; }
        .code-block { background: #1e1e1e; color: #d4d4d4; padding: 1.5rem; border-radius: 8px; overflow-x: auto; margin: 1rem 0; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; line-height: 1.6; border-left: 4px solid var(--accent); }
        .info-box { background: #dbeafe; border-left: 4px solid var(--primary); padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; }
        .warning-box { background: #fef3c7; border-left: 4px solid var(--warning); padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; }
        .success-box { background: #dcfce7; border-left: 4px solid var(--success); padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; }
        table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; background: var(--bg-card); }
        table th { background: var(--primary); color: white; padding: 1rem; text-align: left; font-weight: 600; }
        table td { padding: 1rem; border-bottom: 1px solid var(--border); }
        footer { background: var(--text-dark); color: white; padding: 2rem; text-align: center; margin-top: auto; }
        footer a { color: var(--accent); text-decoration: none; }
        @media (max-width: 768px) { header h1 { font-size: 2rem; } main { padding: 2rem 1rem; } }
    </style>
</head>
<body>
    <header>
        <a href="../kubernetes/k8s_security_index.html" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to Security Guide
        </a>
        <h1><i class="fas fa-key"></i> Secrets Management</h1>
        <p>Encryption, External Stores, and Secure Credential Handling in Kubernetes</p>
    </header>

    <main>
        <section class="intro-section">
            <h2><i class="fas fa-shield-alt"></i> Secrets Management Overview</h2>
            <p>
                Kubernetes Secrets are objects that contain small amounts of sensitive data. Without proper secrets management, 
                passwords, API keys, and tokens can be exposed, leading to compromised systems. This guide covers encryption, 
                external secret stores, and best practices.
            </p>
            <div class="info-box">
                <strong>üí° Key Insight:</strong> By default, Kubernetes secrets are stored unencrypted in etcd. Always enable 
                encryption at rest and use external secret management tools.
            </div>
        </section>

        <section class="intro-section">
            <h2><i class="fas fa-lock"></i> Secret Types in Kubernetes</h2>
            <ul>
                <li><strong>Opaque:</strong> Default secret type for arbitrary data</li>
                <li><strong>kubernetes.io/service-account-token:</strong> Service account tokens</li>
                <li><strong>kubernetes.io/dockercfg:</strong> Serialized Docker config</li>
                <li><strong>kubernetes.io/dockercfg-json:</strong> Docker registry credentials</li>
                <li><strong>kubernetes.io/basic-auth:</strong> Credentials for basic authentication</li>
                <li><strong>kubernetes.io/ssh-auth:</strong> SSH authentication data</li>
                <li><strong>kubernetes.io/tls:</strong> TLS certificate and key pair</li>
                <li><strong>bootstrap.kubernetes.io/token:</strong> Bootstrap token data</li>
            </ul>
        </section>

        <section class="intro-section">
            <h2><i class="fas fa-crypt</i> Encryption at Rest</h2>
            <p>Configure the Kubernetes API server to encrypt secrets at rest using EncryptionConfiguration:</p>
            
            <h3>Enable Encryption Configuration</h3>
            <div class="code-block">
# Create encryption configuration file
/etc/kubernetes/enc/encryption-config.yaml

apiVersion: apiserver.config.k8s.io/v1
kind: EncryptionConfiguration
resources:
- resources:
  - secrets
  - configmaps
  providers:
  - aescbc:
      keys:
      - name: key1
        secret: <base64-encoded-32-byte-key>
  - identity: {}
            </div>

            <h3>Configure API Server</h3>
            <div class="code-block">
# Update /etc/kubernetes/manifests/kube-apiserver.yaml
--encryption-provider-config=/etc/kubernetes/enc/encryption-config.yaml
--encryption-provider-config-automatic-reload=true
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Important:</strong> Encrypting existing secrets requires re-creating them. Plan for downtime 
                or use gradual migration strategies.
            </div>
        </section>

        <section class="intro-section">
            <h2><i class="fas fa-vault"></i> External Secret Management Tools</h2>

            <h3>HashiCorp Vault</h3>
            <p>Industry-leading secrets management platform:</p>
            <ul>
                <li>Centralized secrets storage and access control</li>
                <li>Dynamic secret generation</li>
                <li>Audit logging and secret rotation</li>
                <li>Multiple authentication methods</li>
            </ul>

            <h3>AWS Secrets Manager</h3>
            <p>AWS-native secrets management:</p>
            <ul>
                <li>Automatic secret rotation</li>
                <li>IAM-based access control</li>
                <li>Integration with EKS</li>
                <li>CloudTrail audit logging</li>
            </ul>

            <h3>Azure Key Vault</h3>
            <p>Azure-native key and secrets management:</p>
            <ul>
                <li>Managed HSM support</li>
                <li>Automatic rotation</li>
                <li>Integration with AKS</li>
                <li>RBAC-based access control</li>
            </ul>

            <h3>External Secrets Operator (ESO)</h3>
            <p>Kubernetes operator for external secret syncing:</p>
            <div class="code-block">
kubectl apply -f https://github.com/external-secrets/external-secrets/releases/download/v0.9.0/external-secrets.yaml

# Create SecretStore
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: vault-store
spec:
  provider:
    vault:
      server: "https://vault.example.com"
      path: "secret"
      auth:
        kubernetes:
          mountPath: "kubernetes"
            </div>
        </section>

        <section class="intro-section">
            <h2><i class="fas fa-check-circle"></i> Secrets Management Best Practices</h2>

            <table>
                <tr>
                    <th>Practice</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><strong>Encryption at Rest</strong></td>
                    <td>Always encrypt secrets using KMS or equivalent tools</td>
                </tr>
                <tr>
                    <td><strong>External Secret Stores</strong></td>
                    <td>Use Vault, AWS Secrets Manager, or similar for production</td>
                </tr>
                <tr>
                    <td><strong>RBAC for Secrets</strong></td>
                    <td>Limit access to secrets using Kubernetes RBAC and namespace isolation</td>
                </tr>
                <tr>
                    <td><strong>Secret Rotation</strong></td>
                    <td>Implement automatic rotation for credentials and API keys</td>
                </tr>
                <tr>
                    <td><strong>Audit Logging</strong></td>
                    <td>Log all secret access and modifications for compliance</td>
                </tr>
                <tr>
                    <td><strong>Never Log Secrets</strong></td>
                    <td>Exclude secrets from logs, error messages, and monitoring</td>
                </tr>
            </table>

            <div class="success-box">
                <strong>‚úì Recommendation:</strong> Use External Secrets Operator with Vault for production clusters 
                combining centralized management with Kubernetes-native operations.
            </div>
        </section>

        <section class="intro-section">
            <h2><i class="fas fa-bug"></i> Common Secrets Management Issues</h2>
            <h3>Secrets Exposed in Logs</h3>
            <p><strong>Solution:</strong> Implement log filtering to redact sensitive data</p>

            <h3>Hardcoded Secrets in Code</h3>
            <p><strong>Solution:</strong> Use git hooks to prevent secret commits; scan repositories with tools like TruffleHog</p>

            <h3>Secret Sprawl</h3>
            <p><strong>Solution:</strong> Maintain inventory of all secrets and implement lifecycle management</p>
        </section>
    </main>

    <footer>
        <p><i class="fas fa-heart"></i> Built with passion for the Cloud-Native community</p>
        <p>&copy; 2025 Kubernetes Insights</p>
    </footer>
</body>
</html>

