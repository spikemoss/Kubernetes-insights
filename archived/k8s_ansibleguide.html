<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ansible Automation for Kubernetes Setup</title>
  <style>
    body {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe, #dbeafe);
      font-family: Arial, sans-serif;
      color: #333;
      padding: 20px;
      line-height: 1.6;
    }
    h1, h2, h3 {
      color: #003d5b;
    }
    details {
      margin-bottom: 15px;
      background: #f7f9fc;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
    }
    summary {
      font-weight: bold;
      color: #005f73;
      cursor: pointer;
    }
    summary:hover {
      color: #0a9396;
    }
    pre {
      background-color: #1e1e1e;
      color: #d4d4d4;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
      font-family: 'Courier New', Courier, monospace;
      font-size: 14px;
      line-height: 1.5;
    }
    code {
      display: block;
    }
    footer {
      margin-top: 20px;
      text-align: center;
      color: #666;
    }
  </style>
</head>
<body>
  <header>
    <h1>Ansible Automation for Kubernetes Setup</h1>
    <p>A guide to automate the Kubernetes cluster setup using Ansible playbooks and roles.</p>
  </header>

  <section>
    <details>
      <summary>Inventory Configuration</summary>
      <p>Define the inventory of nodes in a file called <code>hosts.yml</code>:</p>
      <pre><code>
all:
  children:
    masters:
      hosts:
        master1:
          ansible_host: &lt;Master1-IP&gt;
        master2:
          ansible_host: &lt;Master2-IP&gt;
        master3:
          ansible_host: &lt;Master3-IP&gt;
    workers:
      hosts:
        worker1:
          ansible_host: &lt;Worker1-IP&gt;
        worker2:
          ansible_host: &lt;Worker2-IP&gt;
        worker3:
          ansible_host: &lt;Worker3-IP&gt;
    loadbalancers:
      hosts:
        loadbalancer1:
          ansible_host: &lt;LoadBalancer1-IP&gt;
        loadbalancer2:
          ansible_host: &lt;LoadBalancer2-IP&gt;
      </code></pre>
    </details>

    <details>
      <summary>Main Playbook</summary>
      <p>Create the main playbook <code>site.yml</code>:</p>
      <pre><code>
- name: Setup Load Balancers
  hosts: loadbalancers
  roles:
    - loadbalancer

- name: Pre-configure All Nodes
  hosts: all
  roles:
    - preconfig

- name: Install Containerd
  hosts: all
  roles:
    - containerd

- name: Install Kubernetes Components
  hosts: all
  roles:
    - kubernetes

- name: Initialize Master Node and Join Cluster
  hosts: masters
  roles:
    - kubernetes

- name: Join Worker Nodes
  hosts: workers
  roles:
    - kubernetes

- name: Apply Networking (Calico)
  hosts: masters
  roles:
    - calico
      </code></pre>
    </details>

    <details>
      <summary>Role: Load Balancer</summary>
      <p>Tasks for setting up HAProxy:</p>
      <pre><code>
- name: Install HAProxy
  apt:
    name: haproxy
    state: present

- name: Configure HAProxy
  copy:
    src: haproxy.cfg
    dest: /etc/haproxy/haproxy.cfg

- name: Restart HAProxy
  service:
    name: haproxy
    state: restarted
      </code></pre>
    </details>

    <details>
      <summary>Role: Pre-Configuration</summary>
      <p>Tasks for pre-configuring all nodes:</p>
      <pre><code>
- name: Update and Upgrade System
  apt:
    update_cache: yes
    upgrade: dist

- name: Disable Swap
  shell: |
    swapoff -a
    sed -i '/ swap / s/^/#/'
  args:
    executable: /bin/bash

- name: Enable Kernel Modules
  shell: |
    echo 'br_netfilter' > /etc/modules-load.d/k8s.conf
    modprobe br_netfilter
  args:
    executable: /bin/bash

- name: Set Kernel Parameters
  shell: |
    cat <<EOF > /etc/sysctl.d/k8s.conf
    net.bridge.bridge-nf-call-iptables = 1
    net.bridge.bridge-nf-call-ip6tables = 1
    net.ipv4.ip_forward = 1
    EOF
    sysctl --system
  args:
    executable: /bin/bash
      </code></pre>
    </details>

    <details>
      <summary>Role: Containerd</summary>
      <p>Tasks for installing and configuring containerd:</p>
      <pre><code>
- name: Install containerd
  apt:
    name: containerd
    state: present

- name: Configure containerd
  shell: |
    mkdir -p /etc/containerd
    containerd config default > /etc/containerd/config.toml
  args:
    executable: /bin/bash

- name: Restart containerd
  service:
    name: containerd
    state: restarted
      </code></pre>
    </details>

    <details>
      <summary>Role: Kubernetes</summary>
      <p>Tasks for installing Kubernetes components:</p>
      <pre><code>
- name: Add Kubernetes Repository
  shell: |
    curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
    echo "deb https://apt.kubernetes.io/ kubernetes-xenial main" > /etc/apt/sources.list.d/kubernetes.list
  args:
    executable: /bin/bash

- name: Install Kubernetes Components
  apt:
    name:
      - kubelet
      - kubeadm
      - kubectl
    state: present

- name: Hold Kubernetes Packages
  shell: apt-mark hold kubelet kubeadm kubectl
      </code></pre>
    <p>Tasks for initializing master node:</p>
    <pre><code>
- name: Initialize Master Node
  shell: kubeadm init --control-plane-endpoint "&lt;LoadBalancer-IP&gt;:6443" --upload-certs --pod-network-cidr=192.168.0.0/16
  args:
    executable: /bin/bash

- name: Configure kubectl
  shell: |
    mkdir -p $HOME/.kube
    cp /etc/kubernetes/admin.conf $HOME/.kube/config
    chown $(id -u):$(id -g) $HOME/.kube/config
  args:
    executable: /bin/bash
  when: inventory_hostname == 'master1'
      </code></pre>
    </details>

    <details>
      <summary>Role: Calico</summary>
      <p>Tasks for applying Calico networking:</p>
      <pre><code>
- name: Apply Calico Networking
  shell: kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml
  args:
    executable: /bin/bash
      </code></pre>
    </details>
  </section>

  <footer>
    <p>&copy; 2025 Ashish's Kubernetes Automation Guide</p>
  </footer>
</body>
</html>